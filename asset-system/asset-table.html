<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Asset Table</title>
  <link rel="stylesheet" href="asset-table.css">
</head>
<body>
  <div class="sidebar">
    <h2 class="logo">Menu</h2>
    <div class="profile">
      <img src="https://i.pravatar.cc/50?img=3" alt="Profile" />
      <div>
        <h4>David Grey. H</h4>
        <span>Project Manager</span>
      </div>
    </div>
    <ul class="menu">
      <li>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</li>
      <li class="active" id="toggleTable">‡∏î‡∏π‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</li>
      <li>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</li>
    </ul>
  </div>

  <div class="content" id="tableSection">
    <div class="filter-bar">
      <input list="categoryList" id="categoryInput" placeholder="‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">
      <datalist id="categoryList">
        <option value="‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">
        <option value="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
        <option value="‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå">
      </datalist>

      <input list="yearList" id="yearInput" placeholder="‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠">
      <datalist id="yearList">
        <option value="2558">
        <option value="2559">
        <option value="2560">
        <option value="2561">
        <option value="2562">
        <option value="2563">
        <option value="2564">
        <option value="2565">
        <option value="2566">
        <option value="2567">
      </datalist>

      <input list="statusList" id="statusInput" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå">
      <datalist id="statusList">
        <option value="‡∏ß‡πà‡∏≤‡∏á">
        <option value="‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
        <option value="‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°">
      </datalist>

      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå...">
      <button onclick="filterTable()">üîç</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>‡∏ó‡∏µ‡πà</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠</th>
          <th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th>
          <th>‡∏£‡∏∏‡πà‡∏ô</th>
          <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</th>
          <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
          <th>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
          <th>‡∏™‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
          <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
          <th>‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</th>
          <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="dataTable"></tbody>
    </table>
  </div>

  <div id="borrowModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3>
      <p><strong>üë§ ‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°:</strong> <span id="modalBorrower"></span></p>
      <p><strong>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</strong> <span id="modalDate"></span></p>
      <p><strong>‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤:</strong> <span id="modalTime"></span></p>
    </div>
  </div>

  <script>
    document.getElementById("toggleTable").addEventListener("click", () => {
      const tableSection = document.getElementById("tableSection");
      tableSection.style.display = tableSection.style.display === "none" ? "block" : "none";
    });

    function deleteRow(element, index) {
      if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
        let records = JSON.parse(localStorage.getItem("assetRecords")) || [];
        records.splice(index, 1);
        localStorage.setItem("assetRecords", JSON.stringify(records));
        renderTableFromStorage();
      }
    }

    function editRow(index) {
      const records = JSON.parse(localStorage.getItem("assetRecords")) || [];
      const data = records[index];
      data.index = index;
      localStorage.setItem("editData", JSON.stringify(data));
      window.location.href = "edit-asset.html";
    }

    function renderTableFromStorage() {
      const records = JSON.parse(localStorage.getItem("assetRecords")) || [];
      const tbody = document.getElementById("dataTable");
      tbody.innerHTML = "";

      records.forEach((data, i) => {
        const row = document.createElement("tr");
        const statusCell = data.status === '‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°'
          ? `<td class="status-borrowed" onclick="showBorrowInfo('${data.borrower || '-'}', '${data.borrowDate || '-'}', '${data.borrowTime || '-'}')">${data.status}</td>`
          : `<td class="${data.status === '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' ? 'status-unavailable' : ''}">${data.status}</td>`;

        row.innerHTML = `
          <td>${i + 1}</td>
          <td>${data.name}</td>
          <td>${data.brand}</td>
          <td>${data.model}</td>
          <td>${data.assetId}</td>
          <td>${data.serial}</td>
          <td>${data.location}</td>
          <td>${data.condition}</td>
          ${statusCell}
          <td>${data.year}</td>
          <td>${data.note}</td>
          <td class="action-box">
            <a class="edit" href="#" onclick="editRow(${i})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
            <span class="delete" onclick="deleteRow(this, ${i})">‡∏•‡∏ö</span>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterTable() {
      const category = document.getElementById('categoryInput').value.toLowerCase();
      const status = document.getElementById('statusInput').value.toLowerCase();
      const year = document.getElementById('yearInput').value.toLowerCase();
      const keyword = document.getElementById('searchInput').value.toLowerCase();

      const rows = document.querySelectorAll("tbody tr");

      rows.forEach(row => {
        const cells = row.querySelectorAll("td");
        const name = cells[1].textContent.toLowerCase();
        const cat = cells[2].textContent.toLowerCase();
        const state = cells[8].textContent.toLowerCase();
        const yearVal = cells[9].textContent.toLowerCase();

        const matchCategory = category === "" || cat.includes(category);
        const matchStatus = status === "" || state.includes(status);
        const matchYear = year === "" || yearVal.includes(year);
        const matchKeyword = keyword === "" || name.includes(keyword);

        row.style.display = (matchCategory && matchStatus && matchYear && matchKeyword) ? "" : "none";
      });
    }

    function showBorrowInfo(borrower, date, time) {
      const thaiMonths = [
        "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
      ];

      let formattedDate = date;
      if (date && date.includes("-")) {
        const [year, month, day] = date.split("-");
        const thaiYear = parseInt(year) + 543;
        const thaiMonth = thaiMonths[parseInt(month, 10) - 1];
        formattedDate = `${parseInt(day, 10)} ${thaiMonth} ${thaiYear}`;
      }

      const formattedTime = time ? `${time} ‡∏ô.` : "-";
      document.getElementById("modalBorrower").innerText = borrower;
      document.getElementById("modalDate").innerText = formattedDate;
      document.getElementById("modalTime").innerText = formattedTime;
      document.getElementById("borrowModal").style.display = "block";
    }

    function closeModal() {
      document.getElementById("borrowModal").style.display = "none";
    }

    window.addEventListener("click", function(event) {
      const modal = document.getElementById("borrowModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });

    window.onload = () => {
      if (!localStorage.getItem("assetRecords")) {
        const demo = [
          {
            name: "‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå",
            brand: "‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå",
            model: "Pro Tower 280 G9",
            assetId: "001",
            serial: "cd-123",
            location: "SC-2-308",
            condition: "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ",
            status: "‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°",
            year: "2561",
            note: "-",
            borrower: "‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
            borrowDate: "2025-03-26",
            borrowTime: "13:30"
          }
        ];
        localStorage.setItem("assetRecords", JSON.stringify(demo));
      }
      renderTableFromStorage();
    };
  </script>
</body>
</html>
